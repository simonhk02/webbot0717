# Google Sheets è¡Œæ•¸ä¸è¶³å•é¡Œä¿®å¾©å ±å‘Š

## å•é¡Œæè¿°

ç”¨æˆ¶å ±å‘Šåœ¨å¯«å…¥è³‡æ–™æ™‚å‡ºç¾æäº¤å¤±æ•—çš„å•é¡Œã€‚ç¶“éæ—¥èªŒåˆ†æç™¼ç¾ï¼š

1. **éŒ¯èª¤è¨Šæ¯**
   ```
   âœ… æ‰¾åˆ°æœ€å¾Œä¸€è¡Œè³‡æ–™: 49, ä¸‹ä¸€å€‹å¯ç”¨è¡Œ: 50
   error: Range ('è¡¨æ ¼å›æ‡‰1'!A50) exceeds grid limits. Max rows: 49, max columns: 36
   ```

2. **æ ¹æœ¬åŸå› **
   - Google Sheets è¡¨æ ¼åªæœ‰ 49 è¡Œ
   - ç³»çµ±å˜—è©¦å¯«å…¥ç¬¬ 50 è¡Œè³‡æ–™
   - Google Sheets API æ‹’çµ•è¶…å‡ºç¶²æ ¼é™åˆ¶çš„æ“ä½œ

3. **å…·é«”ç—‡ç‹€**
   - åœ–ç‰‡ä¸Šå‚³æˆåŠŸï¼Œä½†è¡¨æ ¼å¯«å…¥å¤±æ•—
   - éŒ¯èª¤è¨Šæ¯ï¼š`Range exceeds grid limits`
   - è³‡æ–™ç„¡æ³•æ­£ç¢ºä¿å­˜åˆ° Google Sheets

## ä¿®å¾©æ–¹æ¡ˆ

### ğŸ¯ æ ¸å¿ƒä¿®å¾©ï¼šè‡ªå‹•æ“´å±• Google Sheets è¡Œæ•¸

**æ–°å¢å‡½æ•¸**: `ensureSheetRowsCapacity`

**åŠŸèƒ½ç‰¹é»**ï¼š
1. **æ™ºèƒ½æª¢æ¸¬**ï¼šè‡ªå‹•ç²å–å·¥ä½œè¡¨ç•¶å‰è¡Œæ•¸
2. **å‹•æ…‹æ“´å±•**ï¼šæ ¹æ“šéœ€è¦è¨ˆç®—ä¸¦æ·»åŠ è¡Œæ•¸
3. **ç·©è¡æ©Ÿåˆ¶**ï¼šé¡å¤–æ·»åŠ  10 è¡Œä½œç‚ºç·©è¡
4. **é‡è©¦æ©Ÿåˆ¶**ï¼šä½¿ç”¨ pRetry ç¢ºä¿æ“ä½œæˆåŠŸ
5. **éŒ¯èª¤è™•ç†**ï¼šå®Œå–„çš„ç•°å¸¸æ•ç²å’Œæ—¥èªŒè¨˜éŒ„

### ğŸ”§ æŠ€è¡“å¯¦ç¾

**1. ç²å–å·¥ä½œè¡¨å…ƒæ•¸æ“š**
```javascript
const sheetResponse = await sheets.spreadsheets.get({
  spreadsheetId,
  fields: 'sheets(properties(title,gridProperties))'
});
```

**2. æª¢æŸ¥è¡Œæ•¸éœ€æ±‚**
```javascript
const currentRows = sheet.properties.gridProperties.rowCount;
const needsExpansion = currentRows < requiredRows;
```

**3. å‹•æ…‹æ“´å±•è¡Œæ•¸**
```javascript
await sheets.spreadsheets.batchUpdate({
  spreadsheetId,
  requestBody: {
    requests: [{
      appendDimension: {
        sheetId: sheet.properties.sheetId,
        dimension: 'ROWS',
        length: additionalRows
      }
    }]
  }
});
```

### ğŸ“Š é›†æˆåˆ°å¯«å…¥æµç¨‹

**ä¿®æ”¹ `writeToSheet` å‡½æ•¸**ï¼š
1. è¨ˆç®—ä¸‹ä¸€å€‹å¯ç”¨è¡Œè™Ÿ
2. **æ–°å¢**ï¼šèª¿ç”¨ `ensureSheetRowsCapacity` ç¢ºä¿è¡Œæ•¸è¶³å¤ 
3. æº–å‚™ä¸¦å¯«å…¥è³‡æ–™

```javascript
// æµä¸‹ä¸€å€‹å¯ç”¨è¡Œ
const nextRowIndex = await getNextRowIndex(sheets, sheetId, sheetName);

// ç¢ºä¿å·¥ä½œè¡¨æœ‰è¶³å¤ çš„è¡Œæ•¸
const rowsCapacityEnsured = await ensureSheetRowsCapacity(sheets, sheetId, sheetName, nextRowIndex);
if (!rowsCapacityEnsured) {
  throw new ValidationError(`ç„¡æ³•æ“´å±•å·¥ä½œè¡¨è¡Œæ•¸åˆ°ç¬¬ ${nextRowIndex} è¡Œ`);
}
```

### âœ… æ¸¬è©¦é©—è­‰

å‰µå»ºäº†å…¨é¢çš„æ¸¬è©¦è…³æœ¬ `test-sheets-capacity-fix.js`ï¼š

**æ¸¬è©¦æ¡ˆä¾‹**ï¼š
1. âœ… **è¡Œæ•¸æª¢æŸ¥é‚è¼¯**ï¼šé©—è­‰éœ€è¦/ç„¡éœ€æ“´å±•çš„åˆ¤æ–·
2. âœ… **æ“´å±•è¨ˆç®—é‚è¼¯**ï¼šé©—è­‰é¡å¤–è¡Œæ•¸çš„è¨ˆç®—
3. âœ… **é‚Šç•Œæƒ…æ³è™•ç†**ï¼šç©ºå·¥ä½œè¡¨ã€å¤§å‹å·¥ä½œè¡¨ç­‰
4. âœ… **API è«‹æ±‚çµæ§‹**ï¼šé©—è­‰ batchUpdate è«‹æ±‚æ ¼å¼

**æ¸¬è©¦çµæœ**ï¼š
- é€šéç‡ï¼š100% (12/12)
- è¦†è“‹æ‰€æœ‰é—œéµé‚è¼¯å’Œé‚Šç•Œæƒ…æ³
- é©—è­‰ API èª¿ç”¨æ ¼å¼æ­£ç¢º

## ä¿®å¾©æ•ˆæœ

### ğŸš€ å¯¦éš›å ´æ™¯æ”¹å–„

**ä¿®å¾©å‰**ï¼š
```
ç¬¬49è¡Œï¼š[æœ€å¾Œä¸€è¡Œè³‡æ–™]
ç¬¬50è¡Œï¼š[å˜—è©¦å¯«å…¥] â†’ âŒ "exceeds grid limits" éŒ¯èª¤
```

**ä¿®å¾©å¾Œ**ï¼š
```
ç¬¬49è¡Œï¼š[æœ€å¾Œä¸€è¡Œè³‡æ–™]
æª¢æ¸¬ï¼šç•¶å‰49è¡Œï¼Œéœ€è¦50è¡Œ
æ“´å±•ï¼šè‡ªå‹•æ·»åŠ 11è¡Œï¼ˆ1è¡Œéœ€æ±‚ + 10è¡Œç·©è¡ï¼‰
ç¬¬50è¡Œï¼š[æˆåŠŸå¯«å…¥] â†’ âœ… è³‡æ–™ä¿å­˜æˆåŠŸ
```

### ğŸ“ˆ æŠ€è¡“å„ªå‹¢

1. **è‡ªå‹•åŒ–è™•ç†**ï¼šç„¡éœ€æ‰‹å‹•ç®¡ç†å·¥ä½œè¡¨è¡Œæ•¸
2. **æ™ºèƒ½ç·©è¡**ï¼šé ç•™é¡å¤–è¡Œæ•¸é¿å…é »ç¹æ“´å±•
3. **é«˜æ•ˆ API**ï¼šä½¿ç”¨ batchUpdate ä¸€æ¬¡æ€§æ“´å±•
4. **éŒ¯èª¤æ¢å¾©**ï¼šé‡è©¦æ©Ÿåˆ¶ç¢ºä¿æ“ä½œæˆåŠŸ
5. **è©³ç´°æ—¥èªŒ**ï¼šå®Œæ•´çš„æ“´å±•éç¨‹è¨˜éŒ„

### ğŸ¯ æ–°çš„æ—¥èªŒæ ¼å¼

**è¡Œæ•¸æª¢æŸ¥**ï¼š
```
ğŸ“Š å·¥ä½œè¡¨ è¡¨æ ¼å›æ‡‰1 ç•¶å‰è¡Œæ•¸: 49, éœ€è¦è¡Œæ•¸: 50
```

**æ“´å±•æ“ä½œ**ï¼š
```
ğŸ”§ éœ€è¦æ“´å±•å·¥ä½œè¡¨ï¼Œæ·»åŠ  11 è¡Œ
âœ… æˆåŠŸæ“´å±•å·¥ä½œè¡¨ è¡¨æ ¼å›æ‡‰1ï¼Œæ–°å¢ 11 è¡Œ
```

## ä½¿ç”¨æ•ˆæœ

### âœ¨ ç”¨æˆ¶é«”é©—æ”¹å–„

1. **ç„¡æ„Ÿæ“´å±•**ï¼šç”¨æˆ¶ç„¡éœ€é—œå¿ƒè¡¨æ ¼è¡Œæ•¸é™åˆ¶
2. **ç©©å®šå¯«å…¥**ï¼šä¸å†å‡ºç¾ "exceeds grid limits" éŒ¯èª¤
3. **è‡ªå‹•å„ªåŒ–**ï¼šç³»çµ±æ™ºèƒ½ç®¡ç†è¡¨æ ¼å®¹é‡
4. **æå‰æº–å‚™**ï¼šç·©è¡æ©Ÿåˆ¶æ¸›å°‘æœªä¾†æ“´å±•éœ€æ±‚

### ğŸ” ç›£æ§å»ºè­°

1. **é—œæ³¨æ–°æ—¥èªŒ**ï¼šç›£æ§æ“´å±•æ“ä½œçš„é »ç‡å’Œæ•ˆæœ
2. **æ€§èƒ½è©•ä¼°**ï¼šè§€å¯Ÿ API èª¿ç”¨æ¬¡æ•¸å’ŒéŸ¿æ‡‰æ™‚é–“
3. **è³‡æºç®¡ç†**ï¼šå®šæœŸæª¢æŸ¥è¡¨æ ¼å¤§å°å’Œçµæ§‹
4. **éŒ¯èª¤è¿½è¹¤**ï¼šç›£æ§æ“´å±•å¤±æ•—çš„æƒ…æ³

## æŠ€è¡“ç´°ç¯€

### ğŸ”§ API æ¬Šé™è¦æ±‚

ç¢ºä¿ Google Service Account å…·æœ‰ä»¥ä¸‹æ¬Šé™ï¼š
- `https://www.googleapis.com/auth/spreadsheets`ï¼ˆå·²æœ‰ï¼‰
- å°ç›®æ¨™ Google Sheets çš„ç·¨è¼¯æ¬Šé™

### ğŸ“Š æ€§èƒ½è€ƒé‡

1. **ç·©è¡ç­–ç•¥**ï¼š+10 è¡Œç·©è¡æ¸›å°‘é »ç¹ API èª¿ç”¨
2. **æ‰¹é‡æ“ä½œ**ï¼šä½¿ç”¨ batchUpdate è€Œéå¤šæ¬¡å–®è¡Œæ“ä½œ
3. **éŒ¯èª¤è™•ç†**ï¼šé‡è©¦æ©Ÿåˆ¶ç¢ºä¿æ“ä½œå¯é æ€§
4. **è³‡æºå„ªåŒ–**ï¼šåªåœ¨éœ€è¦æ™‚åŸ·è¡Œæ“´å±•æ“ä½œ

### ğŸ›¡ï¸ å®‰å…¨æ€§

1. **é©—è­‰æ©Ÿåˆ¶**ï¼šæª¢æŸ¥å·¥ä½œè¡¨å­˜åœ¨æ€§å’Œæ¬Šé™
2. **é‚Šç•Œæª¢æŸ¥**ï¼šé˜²æ­¢ç„¡æ•ˆçš„è¡Œæ•¸è¨ˆç®—
3. **éŒ¯èª¤æ•ç²**ï¼šå®Œå–„çš„ç•°å¸¸è™•ç†é¿å…ç¨‹å¼å´©æ½°
4. **æ—¥èªŒè¨˜éŒ„**ï¼šè©³ç´°è¨˜éŒ„æ‰€æœ‰æ“ä½œä¾¿æ–¼å¯©è¨ˆ

## ç¸½çµ

æ­¤æ¬¡ä¿®å¾©å¾¹åº•è§£æ±ºäº† Google Sheets è¡Œæ•¸ä¸è¶³å°è‡´çš„å¯«å…¥å¤±æ•—å•é¡Œï¼š

- âœ… **è‡ªå‹•æª¢æ¸¬**ï¼šæ™ºèƒ½è­˜åˆ¥è¡¨æ ¼è¡Œæ•¸éœ€æ±‚
- âœ… **å‹•æ…‹æ“´å±•**ï¼šè‡ªå‹•æ·»åŠ å¿…è¦çš„è¡Œæ•¸
- âœ… **ç·©è¡æ©Ÿåˆ¶**ï¼šé ç•™ç©ºé–“é¿å…é »ç¹æ“ä½œ
- âœ… **å®Œå–„æ¸¬è©¦**ï¼š100% æ¸¬è©¦è¦†è“‹ç‡é©—è­‰
- âœ… **ç”¨æˆ¶é€æ˜**ï¼šç„¡æ„ŸçŸ¥çš„è‡ªå‹•åŒ–è™•ç†

ç¾åœ¨ç”¨æˆ¶å¯ä»¥æ”¾å¿ƒä½¿ç”¨ï¼Œç„¡è«– Google Sheets æœ‰å¤šå°‘è¡Œï¼Œç³»çµ±éƒ½æœƒè‡ªå‹•ç¢ºä¿æœ‰è¶³å¤ çš„ç©ºé–“ä¾†å¯«å…¥æ–°çš„è²»ç”¨è¨˜éŒ„ï¼Œå†ä¹Ÿä¸æœƒå‡ºç¾ "exceeds grid limits" çš„éŒ¯èª¤ï¼ 