<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§  AI æ™ºèƒ½å„€è¡¨æ¿ - WhatsApp è²»ç”¨åˆ†æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Microsoft JhengHei', sans-serif;
        }
        
        .glassmorphism {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        
        .card-hover {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.5);
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .filter-container {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 24px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 10px 20px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .insight-item {
            background: rgba(255, 255, 255, 0.1);
            border-left: 4px solid #667eea;
            padding: 16px;
            margin: 12px 0;
            border-radius: 8px;
            color: white;
        }
        
        .tab-container {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 24px;
        }
        
        .tab-button {
            flex: 1;
            padding: 12px 16px;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab-button.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-1px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .quality-indicator {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .quality-excellent { background: #10b981; color: white; }
        .quality-good { background: #3b82f6; color: white; }
        .quality-fair { background: #f59e0b; color: white; }
        .quality-poor { background: #ef4444; color: white; }
    </style>
</head>
<body class="p-4">
    <div class="max-w-7xl mx-auto">
        <!-- æ¨™é¡Œå€åŸŸ -->
        <div class="glassmorphism p-6 mb-6 text-center">
            <h1 class="text-4xl font-bold text-white mb-2">
                ğŸ§  AI æ™ºèƒ½å„€è¡¨æ¿
            </h1>
            <p class="text-white/80 text-lg">
                åŸºæ–¼ Claude AI çš„æ™ºèƒ½æ•¸æ“šåˆ†æèˆ‡æ´å¯Ÿ
            </p>
            <div id="lastUpdated" class="text-white/60 text-sm mt-2"></div>
        </div>

        <!-- æœˆä»½ç¯©é¸å™¨ -->
        <div class="filter-container">
            <div class="flex flex-wrap items-center gap-4">
                <label class="text-white font-semibold">ğŸ“… æœˆä»½ç¯©é¸:</label>
                <select id="monthFilter" class="bg-white/20 text-white border border-white/30 rounded-lg px-4 py-2 backdrop-blur-sm">
                    <option value="">æ‰€æœ‰æœˆä»½</option>
                </select>
                <button id="applyFilter" class="btn-primary">
                    ğŸ” æ‡‰ç”¨ç¯©é¸
                </button>
                <button id="clearFilter" class="btn-secondary">
                    ğŸ—‘ï¸ æ¸…é™¤ç¯©é¸
                </button>
                <div id="filterStatus" class="text-white/80 text-sm"></div>
            </div>
        </div>

        <!-- æ¨™ç±¤å°èˆª -->
        <div class="tab-container">
            <button class="tab-button active" onclick="switchTab('overview')">ğŸ“Š æ¦‚è¦½</button>
            <button class="tab-button" onclick="switchTab('charts')">ğŸ“ˆ åœ–è¡¨</button>
            <button class="tab-button" onclick="switchTab('insights')">ğŸ’¡ æ´å¯Ÿ</button>
            <button class="tab-button" onclick="switchTab('report')">ğŸ“‹ å®Œæ•´å ±å‘Š</button>
            <button class="tab-button" onclick="switchTab('data')">ğŸ” æ•¸æ“šè©³æƒ…</button>
        </div>

        <!-- è¼‰å…¥ç‹€æ…‹ -->
        <div id="loadingContainer" class="glassmorphism p-8 text-center">
            <div class="loading-spinner"></div>
            <p class="text-white mt-4 text-lg">ğŸ¤– AI æ­£åœ¨åˆ†ææ‚¨çš„æ•¸æ“š...</p>
            <p class="text-white/70 text-sm">é€™å¯èƒ½éœ€è¦å¹¾ç§’é˜æ™‚é–“</p>
        </div>

        <!-- éŒ¯èª¤ä¿¡æ¯ -->
        <div id="errorContainer" class="glassmorphism p-6 text-center hidden">
            <div class="text-red-300 text-xl mb-4">âŒ åˆ†æå¤±æ•—</div>
            <div id="errorMessage" class="text-white/80"></div>
            <button onclick="generateDashboard()" class="btn-primary mt-4">
                ğŸ”„ é‡æ–°åˆ†æ
            </button>
        </div>

        <!-- æ¦‚è¦½æ¨™ç±¤ -->
        <div id="overview-content" class="tab-content active">
            <!-- çµ±è¨ˆå¡ç‰‡ç¶²æ ¼ -->
            <div id="statsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8">
                <!-- çµ±è¨ˆå¡ç‰‡å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>

            <!-- æ•¸æ“šå“è³ªæŒ‡ç¤ºå™¨ -->
            <div class="glassmorphism p-6 mb-6">
                <h3 class="text-xl font-bold text-white mb-4">ğŸ“Š æ•¸æ“šæ¦‚è¦</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 text-center">
                    <div class="text-white">
                        <div class="text-2xl font-bold" id="totalRecords">-</div>
                        <div class="text-sm opacity-80">ç¸½è¨˜éŒ„</div>
                    </div>
                    <div class="text-white">
                        <div class="text-2xl font-bold" id="totalFields">-</div>
                        <div class="text-sm opacity-80">æ•¸æ“šæ¬„ä½</div>
                    </div>
                    <div class="text-white">
                        <div class="text-2xl font-bold" id="sheetName">-</div>
                        <div class="text-sm opacity-80">å·¥ä½œè¡¨</div>
                    </div>
                    <div class="text-white">
                        <div class="text-2xl font-bold" id="aiModel">Claude 3</div>
                        <div class="text-sm opacity-80">AI æ¨¡å‹</div>
                    </div>
                    <div class="text-white">
                        <div class="text-2xl font-bold" id="availableMonths">-</div>
                        <div class="text-sm opacity-80">å¯ç”¨æœˆä»½</div>
                    </div>
                    <div class="text-white">
                        <div class="text-2xl font-bold">
                            <span id="dataQuality" class="quality-indicator">-</span>
                        </div>
                        <div class="text-sm opacity-80">åˆ†æä¿¡å¿ƒ</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åœ–è¡¨æ¨™ç±¤ -->
        <div id="charts-content" class="tab-content">
            <div id="chartsContainer">
                <!-- åœ–è¡¨å°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <!-- æ´å¯Ÿæ¨™ç±¤ -->
        <div id="insights-content" class="tab-content">
            <div class="glassmorphism p-6">
                <h3 class="text-2xl font-bold text-white mb-6">ğŸ’¡ AI æ™ºèƒ½æ´å¯Ÿ</h3>
                <div id="insightsContainer">
                    <!-- æ´å¯Ÿå°‡åœ¨é€™è£¡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- å®Œæ•´å ±å‘Šæ¨™ç±¤ -->
        <div id="report-content" class="tab-content">
            <div class="glassmorphism p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-white">ğŸ“‹ AI å®Œæ•´åˆ†æå ±å‘Š</h3>
                    <button id="exportReport" class="btn-primary">
                        ğŸ“„ åŒ¯å‡ºå ±å‘Š
                    </button>
                </div>
                <div id="fullReportContainer" class="bg-white/10 rounded-lg p-6 text-white">
                    <!-- å®Œæ•´å ±å‘Šå°‡åœ¨é€™è£¡é¡¯ç¤º -->
                </div>
            </div>
        </div>

        <!-- æ•¸æ“šè©³æƒ…æ¨™ç±¤ -->
        <div id="data-content" class="tab-content">
            <div class="glassmorphism p-6">
                <h3 class="text-2xl font-bold text-white mb-6">ğŸ” æ•¸æ“šæºè©³æƒ…</h3>
                <div id="dataDetailsContainer" class="space-y-4">
                    <!-- æ•¸æ“šè©³æƒ…å°‡åœ¨é€™è£¡é¡¯ç¤º -->
                </div>
            </div>
        </div>

        <!-- é è…³ -->
        <div class="glassmorphism p-4 mt-8 text-center">
            <p class="text-white/60 text-sm">
                Â© 2024 WhatsApp AI è²»ç”¨ç®¡ç†ç³»çµ± - æ™ºèƒ½åˆ†æç”± Claude 3 Haiku é©…å‹•
            </p>
        </div>
    </div>

    <script>
        let currentDashboard = null;
        let currentUserId = null;
        let availableMonths = [];

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // å¾ URL ç²å–ç”¨æˆ¶ ID
            const urlParams = new URLSearchParams(window.location.search);
            currentUserId = urlParams.get('userId');
            
            if (!currentUserId) {
                showError('ç¼ºå°‘ç”¨æˆ¶ ID åƒæ•¸');
                return;
            }

            // ç¶å®šäº‹ä»¶
            document.getElementById('applyFilter').addEventListener('click', applyFilter);
            document.getElementById('clearFilter').addEventListener('click', clearFilter);
            document.getElementById('exportReport').addEventListener('click', exportReport);

            // è¼‰å…¥å¯ç”¨æœˆä»½ä¸¦ç”Ÿæˆå„€è¡¨æ¿
            loadAvailableMonths().then(() => {
                generateDashboard();
            });
        });

        // è¼‰å…¥å¯ç”¨æœˆä»½
        async function loadAvailableMonths() {
            try {
                const response = await fetch(`/api/analytics/available-months?userId=${currentUserId}`);
                if (response.ok) {
                    const data = await response.json();
                    availableMonths = data.months || [];
                    
                    const monthFilter = document.getElementById('monthFilter');
                    monthFilter.innerHTML = '<option value="">æ‰€æœ‰æœˆä»½</option>';
                    
                    availableMonths.forEach(month => {
                        const option = document.createElement('option');
                        option.value = month;
                        option.textContent = formatMonth(month);
                        monthFilter.appendChild(option);
                    });
                }
            } catch (error) {
                console.warn('è¼‰å…¥å¯ç”¨æœˆä»½å¤±æ•—:', error);
            }
        }

        // ç”Ÿæˆå„€è¡¨æ¿
        async function generateDashboard(filterMonth = null) {
            showLoading();
            
            try {
                let url = `/api/analytics/dashboard?userId=${currentUserId}`;
                if (filterMonth) {
                    url += `&filterMonth=${filterMonth}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || 'ç”Ÿæˆå„€è¡¨æ¿å¤±æ•—');
                }
                
                currentDashboard = data.data;
                renderDashboard(currentDashboard);
                hideLoading();
                
                // æ›´æ–°ç¯©é¸ç‹€æ…‹
                updateFilterStatus(filterMonth);
                
            } catch (error) {
                console.error('ç”Ÿæˆå„€è¡¨æ¿å¤±æ•—:', error);
                showError(error.message);
            }
        }

        // æ¸²æŸ“å„€è¡¨æ¿
        function renderDashboard(dashboard) {
            // æ›´æ–°æ¨™é¡Œä¿¡æ¯
            document.getElementById('lastUpdated').textContent = 
                `æœ€å¾Œæ›´æ–°: ${new Date(dashboard.lastUpdated).toLocaleString('zh-TW')}`;

            // æ¸²æŸ“çµ±è¨ˆå¡ç‰‡
            renderStatsGrid(dashboard.stats);
            
            // æ¸²æŸ“åœ–è¡¨
            renderCharts(dashboard.charts);
            
            // æ¸²æŸ“æ´å¯Ÿ
            renderInsights(dashboard.insights);
            
            // æ¸²æŸ“å®Œæ•´å ±å‘Š
            renderFullReport(dashboard.fullAnalysisReport);
            
            // æ¸²æŸ“æ•¸æ“šè©³æƒ…
            renderDataDetails(dashboard);
            
            // æ›´æ–°æ•¸æ“šæ¦‚è¦
            updateDataSummary(dashboard);
        }

        // æ¸²æŸ“çµ±è¨ˆå¡ç‰‡
        function renderStatsGrid(stats) {
            const container = document.getElementById('statsGrid');
            container.innerHTML = '';
            
            stats.forEach(stat => {
                const card = document.createElement('div');
                card.className = 'stat-card card-hover';
                card.innerHTML = `
                    <div class="text-4xl mb-3">${stat.icon}</div>
                    <div class="text-white/90 text-sm font-medium mb-2">${stat.title}</div>
                    <div class="text-white text-2xl font-bold mb-1">${stat.value}</div>
                    ${stat.subtitle ? `<div class="text-white/70 text-xs">${stat.subtitle}</div>` : ''}
                `;
                container.appendChild(card);
            });
        }

        // æ¸²æŸ“åœ–è¡¨
        function renderCharts(charts) {
            const container = document.getElementById('chartsContainer');
            container.innerHTML = '';
            
            charts.forEach((chart, index) => {
                const chartDiv = document.createElement('div');
                chartDiv.className = 'chart-container';
                chartDiv.innerHTML = `
                    <h4 class="text-xl font-bold text-gray-800 mb-2">${chart.title}</h4>
                    <p class="text-gray-600 text-sm mb-4">${chart.description}</p>
                    <div style="position: relative; height: 400px;">
                        <canvas id="chart-${index}"></canvas>
                    </div>
                `;
                container.appendChild(chartDiv);
                
                // æ¸²æŸ“åœ–è¡¨
                const ctx = document.getElementById(`chart-${index}`).getContext('2d');
                new Chart(ctx, {
                    type: chart.type,
                    data: chart.data,
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    padding: 20,
                                    usePointStyle: true
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        if (chart.type === 'doughnut') {
                                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                            const percentage = ((context.raw / total) * 100).toFixed(1);
                                            return `${context.label}: $${context.raw.toLocaleString()} (${percentage}%)`;
                                        }
                                        return `${context.dataset.label}: $${context.raw.toLocaleString()}`;
                                    }
                                }
                            }
                        },
                        scales: chart.type !== 'doughnut' ? {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                }
                            }
                        } : {}
                    }
                });
            });
        }

        // æ¸²æŸ“æ´å¯Ÿ
        function renderInsights(insights) {
            const container = document.getElementById('insightsContainer');
            container.innerHTML = '';
            
            if (!insights || insights.length === 0) {
                container.innerHTML = '<p class="text-white/70">æš«ç„¡ AI æ´å¯Ÿ</p>';
                return;
            }
            
            insights.forEach((insight, index) => {
                const insightDiv = document.createElement('div');
                insightDiv.className = 'insight-item';
                insightDiv.innerHTML = `
                    <div class="flex items-start">
                        <span class="text-xl mr-3">ğŸ’¡</span>
                        <div>
                            <div class="font-semibold mb-1">æ´å¯Ÿ ${index + 1}</div>
                            <div class="text-sm opacity-90">${insight}</div>
                        </div>
                    </div>
                `;
                container.appendChild(insightDiv);
            });
        }

        // æ¸²æŸ“å®Œæ•´å ±å‘Š
        function renderFullReport(report) {
            const container = document.getElementById('fullReportContainer');
            if (report) {
                // å°‡å ±å‘Šæ–‡æœ¬è½‰æ›ç‚º HTML æ ¼å¼
                const formattedReport = report
                    .replace(/^# (.+)$/gm, '<h2 class="text-2xl font-bold mt-6 mb-4 text-yellow-300">$1</h2>')
                    .replace(/^## (.+)$/gm, '<h3 class="text-xl font-bold mt-4 mb-3 text-blue-300">$1</h3>')
                    .replace(/^### (.+)$/gm, '<h4 class="text-lg font-semibold mt-3 mb-2 text-green-300">$1</h4>')
                    .replace(/\*\*(.+?)\*\*/g, '<strong class="text-yellow-200">$1</strong>')
                    .replace(/\n\n/g, '</p><p class="mb-3">')
                    .replace(/^(.+)$/gm, '<p class="mb-3">$1</p>');
                
                container.innerHTML = formattedReport;
            } else {
                container.innerHTML = '<p class="text-white/70">å ±å‘Šç”Ÿæˆä¸­...</p>';
            }
        }

        // æ¸²æŸ“æ•¸æ“šè©³æƒ…
        function renderDataDetails(dashboard) {
            const container = document.getElementById('dataDetailsContainer');
            const dataSource = dashboard.dataSource;
            
            container.innerHTML = `
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-white mb-3">ğŸ“Š æ•¸æ“šæºä¿¡æ¯</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                        <div class="text-white/80">
                            <span class="font-medium">è©¦ç®—è¡¨ ID:</span><br>
                            <code class="text-xs bg-black/20 px-2 py-1 rounded">${dataSource.spreadsheetId}</code>
                        </div>
                        <div class="text-white/80">
                            <span class="font-medium">å·¥ä½œè¡¨åç¨±:</span><br>
                            <span class="text-white">${dataSource.sheetName}</span>
                        </div>
                        <div class="text-white/80">
                            <span class="font-medium">æœ€å¾ŒåŒæ­¥:</span><br>
                            <span class="text-white">${new Date(dataSource.lastSync).toLocaleString('zh-TW')}</span>
                        </div>
                        <div class="text-white/80">
                            <span class="font-medium">åˆ†æä¿¡å¿ƒåº¦:</span><br>
                            <span class="text-white">${Math.round(dataSource.confidence * 100)}%</span>
                        </div>
                    </div>
                </div>
                <div class="bg-white/10 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-white mb-3">ğŸ·ï¸ æ¬„ä½çµæ§‹</h4>
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 text-xs">
                        ${dataSource.headers.map(header => 
                            `<span class="bg-white/20 px-2 py-1 rounded text-white">${header || '(ç©ºç™½)'}</span>`
                        ).join('')}
                    </div>
                </div>
            `;
        }

        // æ›´æ–°æ•¸æ“šæ¦‚è¦
        function updateDataSummary(dashboard) {
            document.getElementById('totalRecords').textContent = dashboard.dataSource.headers.length;
            document.getElementById('totalFields').textContent = dashboard.stats.find(s => s.title === 'è¨˜éŒ„æ•¸é‡')?.value || '-';
            document.getElementById('sheetName').textContent = dashboard.dataSource.sheetName;
            document.getElementById('availableMonths').textContent = dashboard.availableMonths?.length || 0;
            
            const qualityElement = document.getElementById('dataQuality');
            const quality = dashboard.dataQuality || 'unknown';
            qualityElement.textContent = getQualityText(quality);
            qualityElement.className = `quality-indicator quality-${quality}`;
        }

        // æ¨™ç±¤åˆ‡æ›
        function switchTab(tabName) {
            // éš±è—æ‰€æœ‰å…§å®¹
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„æ´»å‹•ç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„å…§å®¹
            document.getElementById(`${tabName}-content`).classList.add('active');
            
            // æ¿€æ´»é¸ä¸­çš„æŒ‰éˆ•
            event.target.classList.add('active');
        }

        // æ‡‰ç”¨ç¯©é¸
        function applyFilter() {
            const filterMonth = document.getElementById('monthFilter').value;
            if (filterMonth) {
                generateDashboard(filterMonth);
            } else {
                generateDashboard();
            }
        }

        // æ¸…é™¤ç¯©é¸
        function clearFilter() {
            document.getElementById('monthFilter').value = '';
            generateDashboard();
        }

        // æ›´æ–°ç¯©é¸ç‹€æ…‹
        function updateFilterStatus(filterMonth) {
            const statusElement = document.getElementById('filterStatus');
            if (filterMonth) {
                statusElement.innerHTML = `ğŸ“… æ­£åœ¨é¡¯ç¤º: <strong>${formatMonth(filterMonth)}</strong>`;
            } else {
                statusElement.innerHTML = 'ğŸ“Š é¡¯ç¤ºæ‰€æœ‰æ•¸æ“š';
            }
        }

        // åŒ¯å‡ºå ±å‘Š
        function exportReport() {
            if (!currentDashboard || !currentDashboard.fullAnalysisReport) {
                alert('æš«ç„¡å¯åŒ¯å‡ºçš„å ±å‘Š');
                return;
            }
            
            const blob = new Blob([currentDashboard.fullAnalysisReport], { type: 'text/plain;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = `AIåˆ†æå ±å‘Š_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        // è¼”åŠ©å‡½æ•¸
        function formatMonth(month) {
            const [year, monthNum] = month.split('-');
            return `${year}å¹´${monthNum}æœˆ`;
        }

        function getQualityText(quality) {
            const qualityMap = {
                'excellent': 'å„ªç§€',
                'good': 'è‰¯å¥½', 
                'fair': 'ä¸€èˆ¬',
                'poor': 'è¼ƒå·®',
                'unknown': 'æœªçŸ¥'
            };
            return qualityMap[quality] || 'æœªçŸ¥';
        }

        function showLoading() {
            document.getElementById('loadingContainer').style.display = 'block';
            document.getElementById('errorContainer').classList.add('hidden');
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'none';
            });
        }

        function hideLoading() {
            document.getElementById('loadingContainer').style.display = 'none';
            document.querySelectorAll('.tab-content').forEach(content => {
                content.style.display = 'block';
            });
            // é‡æ–°æ¿€æ´»ç•¶å‰æ¨™ç±¤
            document.querySelector('.tab-button.active').click();
        }

        function showError(message) {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }
    </script>
</body>
</html> 